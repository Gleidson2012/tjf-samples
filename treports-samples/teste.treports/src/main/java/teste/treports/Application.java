package teste.treports;

import java.io.File;
import java.io.FileOutputStream;
import java.util.List;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.security.oauth2.client.DefaultOAuth2ClientContext;
import org.springframework.security.oauth2.client.OAuth2RestOperations;
import org.springframework.security.oauth2.client.OAuth2RestTemplate;
import org.springframework.security.oauth2.client.token.AccessTokenRequest;
import org.springframework.security.oauth2.client.token.DefaultAccessTokenRequest;
import org.springframework.security.oauth2.client.token.grant.password.ResourceOwnerPasswordResourceDetails;
import org.springframework.security.oauth2.common.OAuth2AccessToken;
import org.springframework.util.StreamUtils;
import org.springframework.web.client.RestTemplate;

@SpringBootApplication
public class Application {

	public static void main(String[] args) {
		SpringApplication.run(Application.class, args);

		ResourceOwnerPasswordResourceDetails resource = new ResourceOwnerPasswordResourceDetails();

		resource.setAccessTokenUri("http://treports.localhost:5009/totvs.rac/connect/token");
		resource.setClientId("treports_ro");
		resource.setClientSecret("totvs@123");
		// resource.setGrantType("password");
		resource.setScope(List.of("authorization_api"));

		resource.setUsername("admin");
		resource.setPassword("totvs@123");

		AccessTokenRequest atr = new DefaultAccessTokenRequest();

		OAuth2RestOperations restTemplateA = new OAuth2RestTemplate(resource, new DefaultOAuth2ClientContext(atr));

		OAuth2AccessToken token = restTemplateA.getAccessToken();

		System.out.println(token.getValue());

		RestTemplate restTemplate = new RestTemplate();

		HttpHeaders headers = new HttpHeaders();
		headers.setBearerAuth(token.getValue());
		headers.setContentType(MediaType.APPLICATION_JSON_UTF8);

		ReportRequest reportRequest = new ReportRequest();

		HttpEntity<ReportRequest> request = new HttpEntity<>(reportRequest, headers);

		/*
		ResponseEntity<ReportResponse> response = restTemplate.postForEntity(
				"http://localhost:7017/api/trep/v1/reports/1a73b4c7-bd01-46d2-9992-c6b196e8bbae/execute", request,
				ReportResponse.class);

		System.out.println(response.getStatusCodeValue());
		System.out.println(response.getBody().uIdRequest);
		System.out.println(response.getBody().scheduleDate);
		*/
		
		/*
		ResponseEntity<String> response2 = restTemplate.exchange(
				"http://localhost:7017/api/trep/v1/generateds/" + response.getBody().uIdRequest + "/info", HttpMethod.GET,
				String.class);
		*/
		
		HttpEntity entity = new HttpEntity(headers);
		
		/*
		ResponseEntity<String> response2 = restTemplate.exchange(
				"http://localhost:7017/api/trep/v1/generateds/" + response.getBody().uIdRequest + "/info", 
				HttpMethod.GET, entity, String.class);
		*/
		
		ResponseEntity<String> response2 = restTemplate.exchange(
				"http://localhost:7017/api/trep/v1/generateds/8cd3ae1e-ec10-4fcf-9e25-916716dc5b49/info", 
				HttpMethod.GET, entity, String.class);		

		System.out.println(response2.getStatusCodeValue());
		System.out.println(response2.getBody());
		
		// {"id":7,"requestId":11,"scheduleDate":"2019-09-11T21:16:00+00:00","server":null,"startDate":"2019-09-11T21:17:05.0017288+00:00","endDate":"2019-09-11T21:17:05.6344371+00:00","status":"Erro na execução","executionMemory":"{\"dictionary\":\"{\\\"connections\\\":[{\\\"name\\\":\\\"ConCostCenters\\\",\\\"dataProvider\\\":{\\\"uId\\\":\\\"b0aa208e-fa4c-46b7-abf7-92ddb2269225\\\"},\\\"apiName\\\":\\\"CostCenter_v1_000.json\\\",\\\"apiRoute\\\":\\\"/api/ctb/v1\\\",\\\"apiDescription\\\":\\\"API para cadastro de Centro de Custo produtos TOTVS.\\\",\\\"pageSize\\\":100}],\\\"dataSources\\\":[{\\\"name\\\":\\\"DataCostCenters\\\",\\\"connectionname\\\":\\\"ConCostCenters\\\",\\\"sourcetype\\\":3,\\\"objectname\\\":null,\\\"sqlText\\\":null,\\\"parametersSentence\\\":[],\\\"endpointInfo\\\":{\\\"endpoint\\\":\\\"/costcenters\\\",\\\"isList\\\":true,\\\"expands\\\":null,\\\"parametersPath\\\":[]},\\\"parametersGlobalBind\\\":[],\\\"parametersProviderBind\\\":[],\\\"parametersEntitiesBind\\\":[]}],\\\"tables\\\":[{\\\"name\\\":\\\"CostCenter\\\",\\\"description\\\":\\\"Centro de Custo\\\",\\\"sourcename\\\":\\\"DataCostCenters\\\",\\\"selectedColumns\\\":[{\\\"columnName\\\":\\\"CompanyId\\\",\\\"columnDescription\\\":\\\"Código da empresa\\\",\\\"columnType\\\":\\\"System.String\\\",\\\"selectedColumns\\\":[]},{\\\"columnName\\\":\\\"Code\\\",\\\"columnDescription\\\":\\\"Código do Centro de Custo\\\",\\\"columnType\\\":\\\"System.String\\\",\\\"selectedColumns\\\":[]},{\\\"columnName\\\":\\\"RegisterSituation\\\",\\\"columnDescription\\\":\\\"Situação do Centro de Custo (Ativo ou Inativo)\\\",\\\"columnType\\\":\\\"System.String\\\",\\\"selectedColumns\\\":[]},{\\\"columnName\\\":\\\"Name\\\",\\\"columnDescription\\\":\\\"Descrição do Centro de Custo\\\",\\\"columnType\\\":\\\"System.String\\\",\\\"selectedColumns\\\":[]},{\\\"columnName\\\":\\\"SPED\\\",\\\"columnDescription\\\":\\\"Define se Centro de Custo será enviado para SPED\\\",\\\"columnType\\\":\\\"System.String\\\",\\\"selectedColumns\\\":[]},{\\\"columnName\\\":\\\"ShortCode\\\",\\\"columnDescription\\\":\\\"Código Reduzido\\\",\\\"columnType\\\":\\\"System.String\\\",\\\"selectedColumns\\\":[]}],\\\"relationalFields\\\":[],\\\"sqlFields\\\":[]}],\\\"relations\\\":[],\\\"parameters\\\":[],\\\"filters\\\":[],\\\"process\\\":null}\",\"layout\":\"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?>\\n<XtraReportsLayoutSerializer SerializerVersion=\\\"18.2.8.0\\\" Ref=\\\"1\\\" ControlType=\\\"TRF.Rpt.XTraReports.RptReport, TRF.Rpt.XTraReports, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null\\\" Name=\\\"RptReport\\\" Margins=\\\"100, 100, 163, 84\\\" PageWidth=\\\"850\\\" PageHeight=\\\"1100\\\" Version=\\\"18.2\\\" DataMember=\\\"CostCenter\\\" DataSource=\\\"#Ref-0\\\">\\n  <Extensions>\\n    <Item1 Ref=\\\"2\\\" Key=\\\"DataSerializationExtension\\\" Value=\\\"CustomUntypedDataSetSerializer\\\" />\\n  </Extensions>\\n  <Bands>\\n    <Item1 Ref=\\\"3\\\" ControlType=\\\"TopMarginBand\\\" Name=\\\"TopMargin1\\\" HeightF=\\\"163.46\\\">\\n      <Controls>\\n        <Item1 Ref=\\\"4\\\" ControlType=\\\"XRLabel\\\" Name=\\\"label16\\\" Multiline=\\\"true\\\" Text=\\\"Centros de Custo\\\" SizeF=\\\"237.33,51.04\\\" LocationFloat=\\\"206.33, 87.5\\\" Font=\\\"Times New Roman, 24pt\\\" Padding=\\\"2,2,0,0,100\\\">\\n          <StylePriority Ref=\\\"5\\\" UseFont=\\\"false\\\" />\\n        </Item1>\\n        <Item2 Ref=\\\"6\\\" ControlType=\\\"XRLabel\\\" Name=\\\"label15\\\" Multiline=\\\"true\\\" Text=\\\"SPED\\\" SizeF=\\\"104.34,23\\\" LocationFloat=\\\"545.66, 140.46\\\" BackColor=\\\"255,166,166,166\\\" Padding=\\\"2,2,0,0,100\\\">\\n          <StylePriority Ref=\\\"7\\\" UseBackColor=\\\"false\\\" />\\n        </Item2>\\n        <Item3 Ref=\\\"8\\\" ControlType=\\\"XRLabel\\\" Name=\\\"label14\\\" Multiline=\\\"true\\\" Text=\\\"Abreviação\\\" SizeF=\\\"100,23\\\" LocationFloat=\\\"445.66, 140.46\\\" BackColor=\\\"255,166,166,166\\\" Padding=\\\"2,2,0,0,100\\\">\\n          <StylePriority Ref=\\\"9\\\" UseBackColor=\\\"false\\\" />\\n        </Item3>\\n        <Item4 Ref=\\\"10\\\" ControlType=\\\"XRLabel\\\" Name=\\\"label13\\\" Multiline=\\\"true\\\" Text=\\\"Situação\\\" SizeF=\\\"100,23\\\" LocationFloat=\\\"345.66, 140.46\\\" BackColor=\\\"255,166,166,166\\\" Padding=\\\"2,2,0,0,100\\\">\\n          <StylePriority Ref=\\\"11\\\" UseBackColor=\\\"false\\\" />\\n        </Item4>\\n        <Item5 Ref=\\\"12\\\" ControlType=\\\"XRLabel\\\" Name=\\\"label12\\\" Multiline=\\\"true\\\" Text=\\\"Nome\\\" SizeF=\\\"145.65,23\\\" LocationFloat=\\\"200, 140.46\\\" BackColor=\\\"255,166,166,166\\\" Padding=\\\"2,2,0,0,100\\\">\\n          <StylePriority Ref=\\\"13\\\" UseBackColor=\\\"false\\\" />\\n        </Item5>\\n        <Item6 Ref=\\\"14\\\" ControlType=\\\"XRLabel\\\" Name=\\\"label11\\\" Multiline=\\\"true\\\" Text=\\\"Código\\\" SizeF=\\\"100,23\\\" LocationFloat=\\\"100, 140.46\\\" BackColor=\\\"255,166,166,166\\\" Padding=\\\"2,2,0,0,100\\\">\\n          <StylePriority Ref=\\\"15\\\" UseBackColor=\\\"false\\\" />\\n        </Item6>\\n        <Item7 Ref=\\\"16\\\" ControlType=\\\"XRLabel\\\" Name=\\\"label10\\\" Multiline=\\\"true\\\" Text=\\\"Empresa\\\" SizeF=\\\"100,23\\\" LocationFloat=\\\"0, 140.46\\\" BackColor=\\\"255,166,166,166\\\" Padding=\\\"2,2,0,0,100\\\">\\n          <StylePriority Ref=\\\"17\\\" UseBackColor=\\\"false\\\" />\\n        </Item7>\\n        <Item8 Ref=\\\"18\\\" ControlType=\\\"XRLabel\\\" Name=\\\"label1\\\" Multiline=\\\"true\\\" Text=\\\"TJF | TOTVS Java Framework&#xA;\\\" SizeF=\\\"645.66,77.08\\\" LocationFloat=\\\"0, 10.41\\\" Font=\\\"Times New Roman, 37pt\\\" Padding=\\\"2,2,0,0,100\\\">\\n          <StylePriority Ref=\\\"19\\\" UseFont=\\\"false\\\" />\\n        </Item8>\\n      </Controls>\\n    </Item1>\\n    <Item2 Ref=\\\"20\\\" ControlType=\\\"DetailBand\\\" Name=\\\"Detail1\\\" HeightF=\\\"23\\\">\\n      <Controls>\\n        <Item1 Ref=\\\"21\\\" ControlType=\\\"XRLabel\\\" Name=\\\"label2\\\" Multiline=\\\"true\\\" Text=\\\"label2\\\" SizeF=\\\"104.34,23\\\" LocationFloat=\\\"545.66, 0\\\" Padding=\\\"2,2,0,0,100\\\">\\n          <ExpressionBindings>\\n            <Item1 Ref=\\\"22\\\" Expression=\\\"[SPED]\\\" PropertyName=\\\"Text\\\" EventName=\\\"BeforePrint\\\" />\\n          </ExpressionBindings>\\n        </Item1>\\n        <Item2 Ref=\\\"23\\\" ControlType=\\\"XRLabel\\\" Name=\\\"label8\\\" Multiline=\\\"true\\\" Text=\\\"label8\\\" SizeF=\\\"100,23\\\" LocationFloat=\\\"445.66, 0\\\" Padding=\\\"2,2,0,0,100\\\">\\n          <ExpressionBindings>\\n            <Item1 Ref=\\\"24\\\" Expression=\\\"[ShortCode]\\\" PropertyName=\\\"Text\\\" EventName=\\\"BeforePrint\\\" />\\n          </ExpressionBindings>\\n        </Item2>\\n        <Item3 Ref=\\\"25\\\" ControlType=\\\"XRLabel\\\" Name=\\\"label7\\\" Multiline=\\\"true\\\" Text=\\\"label7\\\" SizeF=\\\"100,23\\\" LocationFloat=\\\"345.66, 0\\\" Padding=\\\"2,2,0,0,100\\\">\\n          <ExpressionBindings>\\n            <Item1 Ref=\\\"26\\\" Expression=\\\"[RegisterSituation]\\\" PropertyName=\\\"Text\\\" EventName=\\\"BeforePrint\\\" />\\n          </ExpressionBindings>\\n        </Item3>\\n        <Item4 Ref=\\\"27\\\" ControlType=\\\"XRLabel\\\" Name=\\\"label6\\\" Multiline=\\\"true\\\" Text=\\\"label6\\\" SizeF=\\\"145.65,23\\\" LocationFloat=\\\"200, 0\\\" Padding=\\\"2,2,0,0,100\\\">\\n          <ExpressionBindings>\\n            <Item1 Ref=\\\"28\\\" Expression=\\\"[Name]\\\" PropertyName=\\\"Text\\\" EventName=\\\"BeforePrint\\\" />\\n          </ExpressionBindings>\\n        </Item4>\\n        <Item5 Ref=\\\"29\\\" ControlType=\\\"XRLabel\\\" Name=\\\"label5\\\" Multiline=\\\"true\\\" Text=\\\"label5\\\" SizeF=\\\"100,23\\\" LocationFloat=\\\"0, 0\\\" Padding=\\\"2,2,0,0,100\\\">\\n          <ExpressionBindings>\\n            <Item1 Ref=\\\"30\\\" Expression=\\\"[CompanyId]\\\" PropertyName=\\\"Text\\\" EventName=\\\"BeforePrint\\\" />\\n          </ExpressionBindings>\\n        </Item5>\\n        <Item6 Ref=\\\"31\\\" ControlType=\\\"XRLabel\\\" Name=\\\"label4\\\" Multiline=\\\"true\\\" Text=\\\"label4\\\" SizeF=\\\"100,23\\\" LocationFloat=\\\"100, 0\\\" Padding=\\\"2,2,0,0,100\\\">\\n          <ExpressionBindings>\\n            <Item1 Ref=\\\"32\\\" Expression=\\\"[Code]\\\" PropertyName=\\\"Text\\\" EventName=\\\"BeforePrint\\\" />\\n          </ExpressionBindings>\\n        </Item6>\\n      </Controls>\\n    </Item2>\\n    <Item3 Ref=\\\"33\\\" ControlType=\\\"BottomMarginBand\\\" Name=\\\"BottomMargin1\\\" HeightF=\\\"84\\\">\\n      <Controls>\\n        <Item1 Ref=\\\"34\\\" ControlType=\\\"XRLabel\\\" Name=\\\"label3\\\" Multiline=\\\"true\\\" Text=\\\"Criado por Marcos Paulo dos Santos\\\" TextAlignment=\\\"TopRight\\\" SizeF=\\\"226.96,21.87\\\" LocationFloat=\\\"400.06, 53.12\\\" Padding=\\\"2,2,0,0,100\\\">\\n          <StylePriority Ref=\\\"35\\\" UseTextAlignment=\\\"false\\\" />\\n        </Item1>\\n      </Controls>\\n    </Item3>\\n  </Bands>\\n  <ObjectStorage>\\n    <Item1 Ref=\\\"0\\\" ObjectType=\\\"DevExpress.DataAccess.Json.JsonDataSource,DevExpress.DataAccess.v18.2\\\" Base64=\\\"PEpzb25EYXRhU291cmNlPjxTb3VyY2UgU291cmNlVHlwZT0iRGV2RXhwcmVzcy5EYXRhQWNjZXNzLkpzb24uQ3VzdG9tSnNvblNvdXJjZSIgSnNvbj0ieyYjeEE7ICAmcXVvdDtDb3N0Q2VudGVyJnF1b3Q7OiBbJiN4QTsgICAgeyYjeEE7ICAgICAgJnF1b3Q7Q29kZSZxdW90OzogJnF1b3Q7MSZxdW90OywmI3hBOyAgICAgICZxdW90O0NvbXBhbnlJZCZxdW90OzogJnF1b3Q7MSZxdW90OywmI3hBOyAgICAgICZxdW90O1JlZ2lzdGVyU2l0dWF0aW9uJnF1b3Q7OiAmcXVvdDthY3RpdmUmcXVvdDssJiN4QTsgICAgICAmcXVvdDtOYW1lJnF1b3Q7OiAmcXVvdDtvbmUmcXVvdDssJiN4QTsgICAgICAmcXVvdDtTaG9ydENvZGUmcXVvdDs6ICZxdW90O28mcXVvdDssJiN4QTsgICAgICAmcXVvdDtTUEVEJnF1b3Q7OiB0cnVlJiN4QTsgICAgfSwmI3hBOyAgICB7JiN4QTsgICAgICAmcXVvdDtDb2RlJnF1b3Q7OiAmcXVvdDsyJnF1b3Q7LCYjeEE7ICAgICAgJnF1b3Q7Q29tcGFueUlkJnF1b3Q7OiAmcXVvdDsyJnF1b3Q7LCYjeEE7ICAgICAgJnF1b3Q7UmVnaXN0ZXJTaXR1YXRpb24mcXVvdDs6ICZxdW90O2luYWN0aXZlJnF1b3Q7LCYjeEE7ICAgICAgJnF1b3Q7TmFtZSZxdW90OzogJnF1b3Q7dHdvJnF1b3Q7LCYjeEE7ICAgICAgJnF1b3Q7U2hvcnRDb2RlJnF1b3Q7OiAmcXVvdDt0JnF1b3Q7LCYjeEE7ICAgICAgJnF1b3Q7U1BFRCZxdW90OzogZmFsc2UmI3hBOyAgICB9LCYjeEE7ICAgIHsmI3hBOyAgICAgICZxdW90O0NvZGUmcXVvdDs6ICZxdW90OzMmcXVvdDssJiN4QTsgICAgICAmcXVvdDtDb21wYW55SWQmcXVvdDs6ICZxdW90OzMmcXVvdDssJiN4QTsgICAgICAmcXVvdDtSZWdpc3RlclNpdHVhdGlvbiZxdW90OzogJnF1b3Q7YWN0aXZlJnF1b3Q7LCYjeEE7ICAgICAgJnF1b3Q7TmFtZSZxdW90OzogJnF1b3Q7dGhyZWUmcXVvdDssJiN4QTsgICAgICAmcXVvdDtTaG9ydENvZGUmcXVvdDs6ICZxdW90O3RoJnF1b3Q7LCYjeEE7ICAgICAgJnF1b3Q7U1BFRCZxdW90OzogdHJ1ZSYjeEE7ICAgIH0sJiN4QTsgICAgeyYjeEE7ICAgICAgJnF1b3Q7Q29kZSZxdW90OzogJnF1b3Q7NCZxdW90OywmI3hBOyAgICAgICZxdW90O0NvbXBhbnlJZCZxdW90OzogJnF1b3Q7MSZxdW90OywmI3hBOyAgICAgICZxdW90O1JlZ2lzdGVyU2l0dWF0aW9uJnF1b3Q7OiAmcXVvdDtpbmFjdGl2ZSZxdW90OywmI3hBOyAgICAgICZxdW90O05hbWUmcXVvdDs6ICZxdW90O2ZvdXImcXVvdDssJiN4QTsgICAgICAmcXVvdDtTaG9ydENvZGUmcXVvdDs6ICZxdW90O2YmcXVvdDssJiN4QTsgICAgICAmcXVvdDtTUEVEJnF1b3Q7OiBmYWxzZSYjeEE7ICAgIH0sJiN4QTsgICAgeyYjeEE7ICAgICAgJnF1b3Q7Q29kZSZxdW90OzogJnF1b3Q7NSZxdW90OywmI3hBOyAgICAgICZxdW90O0NvbXBhbnlJZCZxdW90OzogJnF1b3Q7MiZxdW90OywmI3hBOyAgICAgICZxdW90O1JlZ2lzdGVyU2l0dWF0aW9uJnF1b3Q7OiAmcXVvdDthY3RpdmUmcXVvdDssJiN4QTsgICAgICAmcXVvdDtOYW1lJnF1b3Q7OiAmcXVvdDtmaXZlJnF1b3Q7LCYjeEE7ICAgICAgJnF1b3Q7U2hvcnRDb2RlJnF1b3Q7OiAmcXVvdDtmaSZxdW90OywmI3hBOyAgICAgICZxdW90O1NQRUQmcXVvdDs6IHRydWUmI3hBOyAgICB9LCYjeEE7ICAgIHsmI3hBOyAgICAgICZxdW90O0NvZGUmcXVvdDs6ICZxdW90OzYmcXVvdDssJiN4QTsgICAgICAmcXVvdDtDb21wYW55SWQmcXVvdDs6ICZxdW90OzMmcXVvdDssJiN4QTsgICAgICAmcXVvdDtSZWdpc3RlclNpdHVhdGlvbiZxdW90OzogJnF1b3Q7aW5hY3RpdmUmcXVvdDssJiN4QTsgICAgICAmcXVvdDtOYW1lJnF1b3Q7OiAmcXVvdDtzaXgmcXVvdDssJiN4QTsgICAgICAmcXVvdDtTaG9ydENvZGUmcXVvdDs6ICZxdW90O3MmcXVvdDssJiN4QTsgICAgICAmcXVvdDtTUEVEJnF1b3Q7OiBmYWxzZSYjeEE7ICAgIH0mI3hBOyAgXSYjeEE7fSIgLz48U2NoZW1hPjxOb2RlIE5hbWU9IlJlcG9ydCIgVHlwZT0iU3lzdGVtLk9iamVjdCIgU2VsZWN0ZWQ9InRydWUiIE5vZGVUeXBlPSJPYmplY3QiPjxOb2RlIE5hbWU9IkNvc3RDZW50ZXIiIFNlbGVjdGVkPSJ0cnVlIiBOb2RlVHlwZT0iQXJyYXkiPjxOb2RlIE5hbWU9IkNvbXBhbnlJZCIgVHlwZT0iU3lzdGVtLlN0cmluZyIgU2VsZWN0ZWQ9InRydWUiIE5vZGVUeXBlPSJQcm9wZXJ0eSIgLz48Tm9kZSBOYW1lPSJDb2RlIiBUeXBlPSJTeXN0ZW0uU3RyaW5nIiBTZWxlY3RlZD0idHJ1ZSIgTm9kZVR5cGU9IlByb3BlcnR5IiAvPjxOb2RlIE5hbWU9IlJlZ2lzdGVyU2l0dWF0aW9uIiBUeXBlPSJTeXN0ZW0uU3RyaW5nIiBTZWxlY3RlZD0idHJ1ZSIgTm9kZVR5cGU9IlByb3BlcnR5IiAvPjxOb2RlIE5hbWU9Ik5hbWUiIFR5cGU9IlN5c3RlbS5TdHJpbmciIFNlbGVjdGVkPSJ0cnVlIiBOb2RlVHlwZT0iUHJvcGVydHkiIC8+PE5vZGUgTmFtZT0iU1BFRCIgVHlwZT0iU3lzdGVtLlN0cmluZyIgU2VsZWN0ZWQ9InRydWUiIE5vZGVUeXBlPSJQcm9wZXJ0eSIgLz48Tm9kZSBOYW1lPSJTaG9ydENvZGUiIFR5cGU9IlN5c3RlbS5TdHJpbmciIFNlbGVjdGVkPSJ0cnVlIiBOb2RlVHlwZT0iUHJvcGVydHkiIC8+PC9Ob2RlPjwvTm9kZT48L1NjaGVtYT48L0pzb25EYXRhU291cmNlPg==\\\" />\\n  </ObjectStorage>\\n</XtraReportsLayoutSerializer>\",\"user\":\"admin\",\"preview\":false,\"externalLicenseContext\":null,\"generateParams\":{\"parameters\":[],\"filters\":null,\"isView\":false,\"stopExecutionOnError\":true,\"exportFileType\":0,\"customData\":null,\"licenseContext\":null},\"executionMessage\":{\"traceMessages\":[],\"warnigCount\":0,\"errorCount\":0},\"trfLayout\":{\"reportLayout\":{\"margins\":null,\"pageHeight\":0,\"pageWidth\":0,\"reportPrintOptions\":null,\"reportUnit\":0,\"version\":null,\"dataMember\":\"CostCenter\",\"bands\":[{\"$type\":\"TRF.Rpt.Core.Layout.TopMarginBandLayout, TRF.Rpt.Core\",\"reportLayout\":null,\"bindingsLayout\":[],\"dpi\":0.0,\"heightF\":0.0,\"backColor\":0,\"borderColor\":0,\"borderWidth\":0.0,\"controlsLayout\":[],\"foreColor\":0,\"height\":0,\"keepTogether\":false,\"location\":null,\"name\":null,\"borderDashStyle\":0,\"tag\":null,\"right\":0,\"size\":null,\"text\":null,\"sizeF\":null,\"visible\":true,\"anchorVertical\":0,\"padding\":null,\"locationFloat\":null,\"textAlignment\":0,\"borders\":0},{\"$type\":\"TRF.Rpt.Core.Layout.DetailBandLayout, TRF.Rpt.Core\",\"orderByControlLayout\":{\"orderByControl\":[],\"descending\":false},\"reportLayout\":null,\"bindingsLayout\":[],\"dpi\":0.0,\"heightF\":0.0,\"backColor\":0,\"borderColor\":0,\"borderWidth\":0.0,\"controlsLayout\":[],\"foreColor\":0,\"height\":0,\"keepTogether\":false,\"location\":null,\"name\":null,\"borderDashStyle\":0,\"tag\":null,\"right\":0,\"size\":null,\"text\":null,\"sizeF\":null,\"visible\":true,\"anchorVertical\":0,\"padding\":null,\"locationFloat\":null,\"textAlignment\":0,\"borders\":0},{\"$type\":\"TRF.Rpt.Core.Layout.BottomMarginBandLayout, TRF.Rpt.Core\",\"reportLayout\":null,\"bindingsLayout\":[],\"dpi\":0.0,\"heightF\":0.0,\"backColor\":0,\"borderColor\":0,\"borderWidth\":0.0,\"controlsLayout\":[],\"foreColor\":0,\"height\":0,\"keepTogether\":false,\"location\":null,\"name\":null,\"borderDashStyle\":0,\"tag\":null,\"right\":0,\"size\":null,\"text\":null,\"sizeF\":null,\"visible\":true,\"anchorVertical\":0,\"padding\":null,\"locationFloat\":null,\"textAlignment\":0,\"borders\":0}],\"reportMember\":{\"entityLayout\":{\"entityName\":\"CostCenter\",\"source\":{\"$type\":\"TRF.Rpt.Core.Layout.DataSourceApiLayout, TRF.Rpt.Core\",\"endpointInfo\":{\"endpoint\":\"/costcenters\",\"isList\":true,\"expands\":null,\"parameterPathLayout\":null},\"parametersGlobalBind\":[],\"parametersProviderBind\":[],\"parametersEntitiesBind\":[],\"name\":\"DataCostCenters\",\"description\":null,\"connection\":{\"$type\":\"TRF.Rpt.Core.Layout.ConnectionApiLayout, TRF.Rpt.Core\",\"apiName\":\"CostCenter_v1_000.json\",\"apiRoute\":\"/api/ctb/v1\",\"apiDescription\":\"API para cadastro de Centro de Custo produtos TOTVS.\",\"pageSize\":100,\"name\":\"ConCostCenters\",\"uidProvider\":\"b0aa208e-fa4c-46b7-abf7-92ddb2269225\",\"provEntity\":{\"uId\":\"b0aa208e-fa4c-46b7-abf7-92ddb2269225\",\"code\":\"TJF\",\"description\":\"TJF\",\"type\":2,\"dataSourceType\":3,\"databaseType\":null,\"protocol\":1,\"hostName\":\"172.20.0.1\",\"port\":8880,\"route\":null,\"authenticationType\":2,\"userNameBasicAuth\":\"super\",\"passwordBasicAuth\":\"super@123\",\"parameters\":\"[]\",\"createdOn\":\"2019-09-09T17:08:29.0482247+00:00\",\"modifiedOn\":\"2019-09-09T18:33:04.391349+00:00\",\"createdBy\":null,\"modifiedBy\":null,\"complementRoute\":null,\"swaggerRoute\":null,\"authorityAddressOauth\":\"http://rac/totvs.rac/connect/token\",\"clientIdOauth\":\"js_oidc_tjf\",\"clientSecretOauth\":\"totvs@123\",\"scopeOauth\":\"authorization_api\",\"id\":1,\"tenantId\":1}}},\"columns\":[{\"columnName\":\"CompanyId\",\"description\":\"Código da empresa\",\"dataType\":\"System.String\",\"selectedColumns\":[]},{\"columnName\":\"Code\",\"description\":\"Código do Centro de Custo\",\"dataType\":\"System.String\",\"selectedColumns\":[]},{\"columnName\":\"RegisterSituation\",\"description\":\"Situação do Centro de Custo (Ativo ou Inativo)\",\"dataType\":\"System.String\",\"selectedColumns\":[]},{\"columnName\":\"Name\",\"description\":\"Descrição do Centro de Custo\",\"dataType\":\"System.String\",\"selectedColumns\":[]},{\"columnName\":\"SPED\",\"description\":\"Define se Centro de Custo será enviado para SPED\",\"dataType\":\"System.String\",\"selectedColumns\":[]},{\"columnName\":\"ShortCode\",\"description\":\"Código Reduzido\",\"dataType\":\"System.String\",\"selectedColumns\":[]}],\"description\":\"Centro de Custo\",\"relationalFields\":null,\"sqlFields\":null},\"relationLayout\":null,\"childMembers\":[],\"memberTable\":null},\"reportLayout\":null,\"bindingsLayout\":[],\"dpi\":0.0,\"heightF\":0.0,\"backColor\":0,\"borderColor\":0,\"borderWidth\":0.0,\"controlsLayout\":[],\"foreColor\":0,\"height\":0,\"keepTogether\":false,\"location\":null,\"name\":null,\"borderDashStyle\":0,\"tag\":null,\"right\":0,\"size\":null,\"text\":null,\"sizeF\":null,\"visible\":true,\"anchorVertical\":0,\"padding\":null,\"locationFloat\":null,\"textAlignment\":0,\"borders\":0},\"dictionaryLayout\":{\"connections\":[{\"$type\":\"TRF.Rpt.Core.Layout.ConnectionApiLayout, TRF.Rpt.Core\",\"apiName\":\"CostCenter_v1_000.json\",\"apiRoute\":\"/api/ctb/v1\",\"apiDescription\":\"API para cadastro de Centro de Custo produtos TOTVS.\",\"pageSize\":100,\"name\":\"ConCostCenters\",\"uidProvider\":\"b0aa208e-fa4c-46b7-abf7-92ddb2269225\",\"provEntity\":{\"uId\":\"b0aa208e-fa4c-46b7-abf7-92ddb2269225\",\"code\":\"TJF\",\"description\":\"TJF\",\"type\":2,\"dataSourceType\":3,\"databaseType\":null,\"protocol\":1,\"hostName\":\"172.20.0.1\",\"port\":8880,\"route\":null,\"authenticationType\":2,\"userNameBasicAuth\":\"super\",\"passwordBasicAuth\":\"super@123\",\"parameters\":\"[]\",\"createdOn\":\"2019-09-09T17:08:29.0482247+00:00\",\"modifiedOn\":\"2019-09-09T18:33:04.391349+00:00\",\"createdBy\":null,\"modifiedBy\":null,\"complementRoute\":null,\"swaggerRoute\":null,\"authorityAddressOauth\":\"http://rac/totvs.rac/connect/token\",\"clientIdOauth\":\"js_oidc_tjf\",\"clientSecretOauth\":\"totvs@123\",\"scopeOauth\":\"authorization_api\",\"id\":1,\"tenantId\":1}}],\"entities\":[{\"entityName\":\"CostCenter\",\"source\":{\"$type\":\"TRF.Rpt.Core.Layout.DataSourceApiLayout, TRF.Rpt.Core\",\"endpointInfo\":{\"endpoint\":\"/costcenters\",\"isList\":true,\"expands\":null,\"parameterPathLayout\":null},\"parametersGlobalBind\":[],\"parametersProviderBind\":[],\"parametersEntitiesBind\":[],\"name\":\"DataCostCenters\",\"description\":null,\"connection\":{\"$type\":\"TRF.Rpt.Core.Layout.ConnectionApiLayout, TRF.Rpt.Core\",\"apiName\":\"CostCenter_v1_000.json\",\"apiRoute\":\"/api/ctb/v1\",\"apiDescription\":\"API para cadastro de Centro de Custo produtos TOTVS.\",\"pageSize\":100,\"name\":\"ConCostCenters\",\"uidProvider\":\"b0aa208e-fa4c-46b7-abf7-92ddb2269225\",\"provEntity\":{\"uId\":\"b0aa208e-fa4c-46b7-abf7-92ddb2269225\",\"code\":\"TJF\",\"description\":\"TJF\",\"type\":2,\"dataSourceType\":3,\"databaseType\":null,\"protocol\":1,\"hostName\":\"172.20.0.1\",\"port\":8880,\"route\":null,\"authenticationType\":2,\"userNameBasicAuth\":\"super\",\"passwordBasicAuth\":\"super@123\",\"parameters\":\"[]\",\"createdOn\":\"2019-09-09T17:08:29.0482247+00:00\",\"modifiedOn\":\"2019-09-09T18:33:04.391349+00:00\",\"createdBy\":null,\"modifiedBy\":null,\"complementRoute\":null,\"swaggerRoute\":null,\"authorityAddressOauth\":\"http://rac/totvs.rac/connect/token\",\"clientIdOauth\":\"js_oidc_tjf\",\"clientSecretOauth\":\"totvs@123\",\"scopeOauth\":\"authorization_api\",\"id\":1,\"tenantId\":1}}},\"columns\":[{\"columnName\":\"CompanyId\",\"description\":\"Código da empresa\",\"dataType\":\"System.String\",\"selectedColumns\":[]},{\"columnName\":\"Code\",\"description\":\"Código do Centro de Custo\",\"dataType\":\"System.String\",\"selectedColumns\":[]},{\"columnName\":\"RegisterSituation\",\"description\":\"Situação do Centro de Custo (Ativo ou Inativo)\",\"dataType\":\"System.String\",\"selectedColumns\":[]},{\"columnName\":\"Name\",\"description\":\"Descrição do Centro de Custo\",\"dataType\":\"System.String\",\"selectedColumns\":[]},{\"columnName\":\"SPED\",\"description\":\"Define se Centro de Custo será enviado para SPED\",\"dataType\":\"System.String\",\"selectedColumns\":[]},{\"columnName\":\"ShortCode\",\"description\":\"Código Reduzido\",\"dataType\":\"System.String\",\"selectedColumns\":[]}],\"description\":\"Centro de Custo\",\"relationalFields\":null,\"sqlFields\":null}],\"relations\":[],\"parameters\":[],\"filters\":[],\"process\":[]}},\"useSchemaDataSet\":false}","errorMessage":"\n\nInvalid data member 'CostCenter'\nInvalid data member 'CostCenter'","createdOn":"2019-09-11T21:16:42.1927001+00:00","modifiedOn":"2019-09-11T21:17:05.6347734+00:00","createdBy":"admin","modifiedBy":"admin","executionRequest":{"id":11,"reportId":1,"uId":"8cd3ae1e-ec10-4fcf-9e25-916716dc5b49","schedule":0,"user":null,"generateParams":{"parameters":[],"filters":null,"isView":false,"stopExecutionOnError":true,"exportFileType":0,"customData":null,"licenseContext":null},"scheduleParams":{"type":0,"date":null,"repeat":false,"repeatType":0,"repeatWeekPattern":null,"repeatMonthPattern":null,"repeatTime":null},"notificationParams":null,"createdOn":"2019-09-11T21:16:42.1895529+00:00","report":null}}
				
		// ?exportFileType={ExportFileTypeEnum.PDF.GetHashCode()}
		File file = restTemplate.execute(
				"http://localhost:7017/api/trep/v1/generateds/11/file?exportFileType=pdf", 
				HttpMethod.GET, 
				clientHttpRequest -> {
					clientHttpRequest.getHeaders().setBearerAuth(token.getValue());
					clientHttpRequest.getHeaders().setContentType(MediaType.APPLICATION_JSON_UTF8);
				}, 
				clientHttpResponse -> {
		    File ret = File.createTempFile("download", "tmp");
		    StreamUtils.copy(clientHttpResponse.getBody(), new FileOutputStream(ret));
		    return ret;
		});
		
		System.out.println(file.length());
	}
}
